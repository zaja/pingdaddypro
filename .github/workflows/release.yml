name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Extract version from tag
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ steps.version.outputs.VERSION }}
          release_name: PingDaddyPro ${{ steps.version.outputs.VERSION }}
          body: |
            ## What's New in ${{ steps.version.outputs.VERSION }}
            
            ### Security Improvements
            - Fixed brute force protection in Docker environment
            - Improved IP address detection using X-Forwarded-For headers
            - Added IP address validation
            - Enhanced security logging
            - Added cleanup for old login attempts
            
            ### Bug Fixes
            - Brute force protection now works correctly in Docker containers
            - Fixed IP address detection behind reverse proxy
            
            ### Security Features
            - Account lockout after 4 failed attempts (15 minutes)
            - IP lockout after 10 failed attempts (15 minutes)
            - Comprehensive security logging
            - Manual unlock via database or API endpoint
            
            ## Installation
            ```bash
            # One-line install
            curl -fsSL https://raw.githubusercontent.com/zaja/pingdaddypro/main/install.sh | bash
            
            # Or Docker Compose
            git clone https://github.com/zaja/pingdaddypro.git
            cd pingdaddypro
            docker-compose up -d
            ```
            
            ## Default Access
            - URL: http://localhost:5000
            - Username: admin
            - Password: admin123
          draft: false
          prerelease: false
